dfisher | 2023-04-23 03:28:52 UTC | #1

II Team,

Is there a way to create a seed phrase without exposing the seed phrase on the UI? This is perhaps the single biggest point of vulnerability with II. A computer connected to the internet displaying the seed phrase directly on the UI. 

Honestly I don’t know how it could work. Maybe some kind of Bluetooth to a air gap device? 

Or better yet, generate a seed phrase on a air gap device and then QR code it to the II interface? 

Anything I’m not thinking of?

-------------------------

timo | 2023-04-23 06:25:06 UTC | #2

The seed phrase has to either be entered or generated on some other device, as you mentioned an air-gapped one, that can derive a public key from the seed and transmit that to the UI. This solution already exists. It is the recovery device if you use a Ledger hardware wallet as a FIDO device. Your seed phrase is then simply the seed phrase of the hardware wallet.

-------------------------

dfisher | 2023-04-23 07:15:37 UTC | #3

Great! I just figured it out with the FIDO app. Thanks Timo. 

Would you say the security is equivalent using II with a FIDO device as a recovery method vs. using the ledger as a hotkey on the II?

Also, while one can protect the seed phrase generated by II in the browser, it does not look like one can protect the recovery method that relies on a FIDO device. This looks like a major vulnerability in using a FIDO device. Am I right?

-------------------------

Roman | 2023-04-23 13:41:17 UTC | #4

To precise @dfisher's point @timo when he writes:
[quote="dfisher, post:3, topic:19569"]
it does not look like one can protect the recovery method that relies on a FIDO device.
[/quote]

Here is what had explained Diego during the "Spamhaus gate"

[quote="diegop, post:1, topic:18537"]
If ic0.app is blocked, you would use your recovery phrase to access your anchor on the new domain. ([How to recover account with recovery phrase? ](https://support.dfinity.org/hc/en-us/articles/4409372165652-I-cleared-my-browser-cache-and-now-I-m-locked-out-)) **Please note: You will not be able to recover your account with a FIDO device, so you must create a recovery phrase if you want to ensure your account is safe.**
[/quote]

-------------------------

dfisher | 2023-04-23 15:13:05 UTC | #5

Hmm thanks Roman. It seems like the FIDO device is riddled with vulnerabilities. 

1. You could lose access due to the domain issue

2. You could lose access if a malicious actor took control of your II and then removed the FIDO device as a recovery option since there is no option to make the FIDO device protected

All in all, it doesn’t sound very secure. Let me know if you disagree.

So @timo this leads me back to my original question. How can we create a system for generating a seed phrase for the II using an air gap device and then protecting it? Is there a world in which is could be technically possible? Maybe some quill function with a QR code?

-------------------------

Roman | 2023-04-23 17:39:11 UTC | #6

I agree 100% with you, like almost every time by the way.

About people wanting to use the II, bu wanting to avoid the use of a recovery phrase touching Internet, here is the recap of the discussion, because it answers to your question : 

[quote="dfisher, post:5, topic:19569"]
How can we create a system for generating a seed phrase for the II using an air gap device and then protecting it?
[/quote]

Here is what Jordan wrote back then :

[quote="lastmjs, post:39, topic:18537, full:true"]
I’m increasingly concerned at the nonchalance with which entering seed phrases into internet-connected web UIs is encouraged by the security model of II.
[/quote]

And this : 

[quote="lastmjs, post:71, topic:18537, full:true"]
[quote="bjoern, post:68, topic:18537"]
Remind everyone to use hardware wallets for managing (at least larger amounts of) tokens and neurons. Internet Identity is great for authenticating toward dapps, but it still fundamentally relies on the security of the browser (which is the still piece of software most likely to be affected by zero days), and so fundamentally that isn’t a good way of managing things of significant value.
[/quote]

I wish I had known/understood this back in 2021. I feel like the marketing/eduction around II vs hardware wallets wasn’t really present, or at least I missed it. Seems to me that most of the lay people in the community believe (believed?) II to be extremely secure. It’s only after digging in that we discover these flaws.

So a concrete suggestion is to fix the education/marketing of II, or increase its security. How many people have locked up a lot of ICP on the NNS using II? Probably a lot of people. And the unfortunate thing is that there is currently no way to change that choice AFAIK.
[/quote]

And @bjoern answered this, which answers to your question : 
[quote="bjoern, post:77, topic:18537"]
[quote="lastmjs, post:71, topic:18537"]
I wish I had known/understood this back in 2021. I feel like the marketing/eduction around II vs hardware wallets wasn’t really present, or at least I missed it. Seems to me that most of the lay people in the community believe (believed?) II to be extremely secure. It’s only after digging in that we discover these flaws.
[/quote]

Let me clarify. Authentication with II is still *fundamentally* more secure than browser-based wallets like Metamask or Plug, because the cryptographic key resides in a secure hardware chip and outside of the realm of the browser or even the computer’s main memory. It is, however, also *fundamentally* less secure than a hardware wallet, since the hardware wallet will allow you to inspect the transaction. With web authentication, you as a user must be involved (e.g. fingerprint or face scan), but you don’t see the transaction details.

Let me put out some numbers. Here are values that I would feel comfortable with managing in different ways (these are based on my personal risk profile, everyone will have different limits):

* Browser wallet (e.g. Metamask/Plug) on my own general-purpose devices: $100s, for short time maybe $1’000s.
* Internet Identity on my own general-purpose devices: $1’000s, for short time maybe $10’000s.
* Browser wallet or Internet Identity on a “clean” device that I only use for one specific application *that I personally trust, and where the front-end is decentralized* (e.g. [nns.internetcomputer.org](http://nns.internetcomputer.org)) and that I never connect to public networks: $10’000s and maybe a bit more if I am paranoid about keeping the device clean.
* Hardware wallet (which I *never* connect to a device I don’t own): $100’000s.
* Custom cold-storage/air-gap setup: Anything beyond.

So I did not want to suggest that Internet Identity wasn’t secure – quite to the contrary! I personally think it has the best trade-off between security and usability for day-to-day use. I just want to encourage the use of “non-day-to-day” methods for cases for large amounts of tokens.
[/quote]

So, as we must use the recovery phrase rather than FIDO : or we improve the security of the II seed phrase generation, or we put only few ICP on the wallets not protected by a Ledger Hardwallet used as hotkey. So when you ask :

[quote="dfisher, post:3, topic:19569"]
Would you say the security is equivalent using II with a FIDO device as a recovery method vs. using the ledger as a hotkey on the II?
[/quote]

As you can see, it is not equivalent in term of security. For big amounts, the Ledger must be used as hotkey.

But as you can see, with what @bjoern writes, the problem for the NFT owners stays entire, this is why I was asking this : 
[quote="bjoern, post:77, topic:18537"]
[quote="lastmjs, post:71, topic:18537"]
I wish I had known/understood this back in 2021. I feel like the marketing/eduction around II vs hardware wallets wasn’t really present, or at least I missed it. Seems to me that most of the lay people in the community believe (believed?) II to be extremely secure. It’s only after digging in that we discover these flaws.
[/quote]

Let me clarify. Authentication with II is still *fundamentally* more secure than browser-based wallets like Metamask or Plug, because the cryptographic key resides in a secure hardware chip and outside of the realm of the browser or even the computer’s main memory. It is, however, also *fundamentally* less secure than a hardware wallet, since the hardware wallet will allow you to inspect the transaction. With web authentication, you as a user must be involved (e.g. fingerprint or face scan), but you don’t see the transaction details.

Let me put out some numbers. Here are values that I would feel comfortable with managing in different ways (these are based on my personal risk profile, everyone will have different limits):

* Browser wallet (e.g. Metamask/Plug) on my own general-purpose devices: $100s, for short time maybe $1’000s.
* Internet Identity on my own general-purpose devices: $1’000s, for short time maybe $10’000s.
* Browser wallet or Internet Identity on a “clean” device that I only use for one specific application *that I personally trust, and where the front-end is decentralized* (e.g. [nns.internetcomputer.org](http://nns.internetcomputer.org)) and that I never connect to public networks: $10’000s and maybe a bit more if I am paranoid about keeping the device clean.
* Hardware wallet (which I *never* connect to a device I don’t own): $100’000s.
[/quote]

[quote="Roman, post:107, topic:18537, full:true"]
[quote="bjoern, post:82, topic:18537"]
We are currently designing a scheme that allows *any* canister on the Internet Computer to use the ICP hardware wallet app for securely displaying and signing transactions, and that would work as follows:

* The canister developer specifies for each pair of (canister id, method name) a schema for rendering the parameters. That would likely be a transaction name and a structure that specifies for each field of the Candid argument whether it should be displayed and the title that should be used. (We need to devise a format for this, this actually is the main open design task.)
* The canister then signs said schema with the IC’s threshold ECDSA signature method.
* The dapp front end sends the unsigned transaction along with the signed schema to the hardware wallet.
* The hardware wallet derives the canister’s ECDSA public key from the IC’s ECDSA root public key and the canister id, and verifies the signature on the schema. It then uses the schema to display the transaction to the user, and signs the transaction when the user approves.
[/quote]

Hi @bjoern, hope this message finds you well. Any ETA of this wonderful feature ?
[/quote]

**CONCLUSION :** If we want to use the II, the Ledger as hotkey is a necessity for big amount of ICP, but this does not solve the problem for the NFT.

-------------------------

dfisher | 2023-04-23 21:55:21 UTC | #7

Thank you Roman. 

It looks like Ledger is much more secure than II, which is a bit concerning still because Ledger is still not enabled to work with SNS transactions and we’re about to experience a major wave of SNSs. 

But that still doesn’t answer the question of whether it is technically possible to generate a seed phrase on an airgap device and somehow import that seed phrase into an II. That might solve most of the issues. There must be a way to enable this. @timo

-------------------------

infu | 2023-04-23 21:52:07 UTC | #8

Another tip:
Go thru all of your browser extensions and change their access.
Right click, then choose "When you click the Extension"
![image|690x217](upload://oU35RRyavzMw64DdXuwgFYEb3DU.png)
When you go to a site using MetaMask, you can right click and choose "On ....." then it will always be on on that site. Otherwise you will have to click on it and reload the page.

If you use Mac. Make sure not a lot of apps have special permissions here:
![image|563x500](upload://wsQtIiAaAPvCC7QhsTzePDclFhY.jpeg)
I suppose Accessibility, Input Monitoring and Automation are the worst.

If you set these things right. Not a lot of things will  be able to accessyour browsed page.
You can be certain, that the first ones hacked will be the ones which didn't set these right.

-------------------------

dfisher | 2023-04-23 21:54:23 UTC | #9

I see how that is relevant to browser extensions like metamask and Bitfinity Wallet. But is it relevant for II? Thanks either way.

-------------------------

infu | 2023-04-23 22:16:32 UTC | #10

Most extensions like MetaMask and all wallets work by injecting code into your page. If you do the above, they won't be activated and won't inject anything on the sites for which you didn't explicitly allow them.
See the extension details:
![image|472x500](upload://sndLcZXSqsvEymc6zGfXGmFhb9c.png)

So basically II will be secure if you don't have extensions accessing it and you don't have Mac apps with special privileges.

On Windows - I've got no idea, it was terrible for apps before a few years, not sure now. Macs are based on Unix and the security is tight.

Crackers will go for the low-hanging fruit, which is probably going to be extension - game - Youtube downloader with 10mil downloads. Or a popular screenshot desktop app with too loose security permissions. Not saying you can't get hacked by something else, but it's less likely to happen

-------------------------

