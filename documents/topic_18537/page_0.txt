diegop | 2023-02-23 18:19:22 UTC | #1

**February 19, 2023 Edit:** *Spamhaus as removed `ic0.app` from its blocklist.*



## 1. TL;DR

On February 15 2023, [Spamhaus](https://en.wikipedia.org/wiki/The_Spamhaus_Project), an organization that publishes a [Domain Block List](https://www.spamhaus.org/dbl/) used by some service providers, added the ic0.app domain to its blocklist. The immediate impact is that the usage of ic0.app on social media or emails may be flagged as spam. A further potential consequence may be that some ISPs may no longer route traffic to the ic0.app domain. As a result, some users may no longer be able to directly access the dapps on the Internet Computer (IC) that use the ic0.app domain. Currently, no such cases are known but to address this risk this post explains to users what they can do as a precautionary measure and how they could regain access.

As an immediate action, we recommend that all users:

* Create a recovery phrase for your Internet Identity anchors if you have not already done so ([How to create a recovery phrase](https://support.dfinity.org/hc/en-us/articles/13267203903636-How-Do-I-Create-a-Recovery-Phrase-)). Please note that a recovery device cannot be used to access your account on the new URL, you must use a phrase.
* Reset your Internet Identity recovery phrase if you cannot remember or have lost your existing phrase ([How to reset your recovery phrase](https://support.dfinity.org/hc/en-us/articles/4409371964180-How-do-I-reset-my-recovery-phrase-)).
* ~~Setup your Internet Identity anchors to be usable with the newly introduced URL [identity.internetcomputer.org](http://identity.internetcomputer.org). Please note that we are working on UX improvements that will make the process easier.~~ **UPDATE: Now that ic0.app has been removed from the block list, we recommend that users wait to migrate their devices until we complete work on the migration path. In case of an emergency, make sure that you have a usable recovery phrase following the instructions listed above.**

Last but not least, it is worth noting: DNS blocking is a very common industry practice. Indeed, there are many blocklists around the world with varying policies. Every ISP and/or government does some form of this for legal, security or content policy reasons. Domains which serve user-generated content / apps have a history of being at risk of DNS block lists.

## 2. Background

ISPs and service providers use blocklists to minimize the exposure of users to spam and malicious websites. Spamhaus is one of the organizations that maintain such blocklists. Since ICP smart contracts can host entire web apps at affordable rates, ICP has seen a few malicious actors publishing content that ISPs and other services block for their users, e.g. phishing sites. Social media and communication services, such as email providers, may additionally flag messages including links to ic0.app as spam.

As explained in the recent forum post [Content Filtering via Boundary Nodes](https://forum.dfinity.org/t/content-filtering-via-boundary-nodes/18196), the DFINITY foundation actively scans for such content and blocks it in accordance with the [Code of Conduct](https://dfinity.org/boundary-nodes/ic0-app/code-of-conduct/) established with the ICP community. The smart contracts remain untouched on-chain but are no longer accessible through a regular web browser. There may also be a few false negatives that are not detected.

Spamhaus added ic0.app to its blocklist. The DFINITY Foundation is actively working with Spamhaus to explain the use of ic0.app and asked Spamhaus to remove ic0.app from the blocklist. However, it's uncertain whether this request will be successful.

Please note this incident is different from a ‚Äútakedown request‚Äù. This is an entire domain being added to a blocklist. This is a foreseen event so there are both mitigations and plans for the community to be aware of.

## 3. Precautions

This section describes measures that can be taken today to minimize the impact of ic0.app potentially becoming inaccessible.

### Recommended For Users

We encourage all users to perform the following activities immediately:

* Create a recovery phrase for your II anchors: The following instructions show you how to create a recovery phrase for your II anchors. Once you have created a recovery phrase, store it in a safe place. As a reminder, your recovery phrase will allow you to recover your II and NNS wallet (where you may be holding ICP) in case they are in an environment where ic0.app is blocked. ([How to create a recovery phrase?](https://support.dfinity.org/hc/en-us/articles/13267203903636-How-Do-I-Create-a-Recovery-Phrase-)). If ic0.app is blocked, you would use your recovery phrase to access your anchor on the new domain. ([How to recover account with recovery phrase?](https://support.dfinity.org/hc/en-us/articles/4409372165652-I-cleared-my-browser-cache-and-now-I-m-locked-out-)) Please note: You will not be able to recover your account with a FIDO device, so you must create a recovery phrase if you want to ensure your account is safe.
* ~~Connect your II anchors to identity.internetcomputer.org: The following instructions guide you through the process of setting up your Internet Identity (II) anchors on the new II domain [identity.internetcomputer.org](http://identity.internetcomputer.org). Once you have performed these steps, you can keep using II on the new domain even if identity.ic0.app was no longer accessible. We are working on making this process more user-friendly. Note: for this setup to be successful, identity.ic0.app must be accessible to you.~~ **UPDATE: Now that ic0.app has been removed from the block list, we recommend that users wait to migrate their devices until we complete work on the migration path. In case of an emergency, make sure that you have a usable recovery phrase following the instructions listed above.**

What are the risks if you don‚Äôt follow these precautionary measures?

ELI5: If you don't have access to the ic0.app domain and you haven't performed these steps, then you cannot reach your Identity, which means you cannot access your ICP in the NNS Frontend dapp.

* Is it guaranteed that users will lose access to ic0.app? No, but best be careful and take preventive measures.
* Are there ways to regain access to ic0.app domain? Yes, most notably a VPN.
* Why are these precautions necessary? Because they mitigate the impact of ‚Äúnot having access to ic0.app domain‚Äù. These measures remove the risk tied to ic0.app.

### What DFINITY Foundation is doing

#### Short-term (Now)

* System canisters under separate domain: DFINITY has created a proposal, that was subsequently adopted by the NNS, to add an additional domain for Internet Identity ([identity.internetcomputer.org](http://identity.internetcomputer.org)) and the NNS Frontend dapp ([nns.internetcomputer.org](http://nns.internetcomputer.org)) so users are able to access these URLs without being affected by any regional blocking of ic0.app.
* Switch to new default domain for new canisters: Spamhaus has communicated that ICP can create an environment for ‚Äúmassively automated malice‚Äù. Therefore, DFINITY has set up the domain icp0.io as an alternative default domain to access canisters. If you previously used the URL <canister-id>.ic0.app, you can now alternatively use <canister-id>.icp0.io.
* API calls through decoupled domain: So far, HTTP requests and API calls both used the ic0.app domain. We introduced the domain icp-api.io for API calls and to decouple the two use cases. As a result, API calls will not be affected by reduced availability of domains used to serve HTTP. The Service Worker has been updated to automatically make the API calls to the new domain.
* Accelerate code of conduct enforcement: We plan to further reduce the time between a malicious content being detected and it being blocked.

#### Mid-term (1 week)

* II domain migration: As shown in the [December 2022 II roadmap updat](https://forum.dfinity.org/t/internet-identity-roadmap-update-december-2022/17063)e, the II team has been working on a simple flow to migrate anchors set up under identity.ic0.app to identity.internetcomputer.org. As documented as one of the user precautionary actions above, a migration to this new domain is possible today. However, we will work on making this transition more seamless and self-explanatory.
* Custom domains: Just a few days ago, the foundation [released custom domain support for canisters](https://internetcomputer.org/docs/current/developer-docs/production/custom-domain/). As more developers will use this new capability, the dependency on ic0.app will decrease.

#### Long-term (months)

* The DFINITY team is working on a [new boundary node architecture](https://forum.dfinity.org/t/content-filtering-via-boundary-nodes/18196/3#h-23-what-are-the-main-differences-between-the-current-implementation-and-the-long-term-design-6). By introducing HTTP gateways that are accessible through different domains and operated by different community members, the dependency on a single domain, such as ic0.app, will be significantly reduced.

## 4. Mitigation

Should a social media post or electronic message containing the ic0.app domain be flagged as spam, you can alternatively use the domain icp0.io. All new canisters are accessible through the newly created domain icp0.io. Instead of accessing your canister through <canister-id>.ic0.app, you can alternatively use <canister-id>icp0.io.

In the event of ic0.app being blocked for you, we recommend the following:

* VPN: Use a VPN to connect to a network that is not affected by the Spamhaus blocklist.
* Check your local settings: A local program or system configuration, e.g. a virus scanner, may block ic0.app using the Spamhaus list. Check these settings and exclude ic0.app from being blocked.

Worth noting that another route for users who want to retrieve their IIs, is that they can also modify the hosts file to locally map `identity.ic0.app` to `identity.internetcomputer.org`. You can see instructions on how to do this here: [how to change a hosts file on your computer](https://www.hostinger.com/tutorials/how-to-edit-hosts-file)..

## 5. Potential Questions

### Q: What should be the main take-away for users?

A: All ICP users should (A) set up their II anchor under [identity.internetcomputer.org](http://identity.internetcomputer.org) and (B) create recovery phrases for their internet identity anchors, if they do not already have one yet. 

(C) Users can also change the hosts file to locally map `identity.ic0.app` to `identity.internetcomputer.org`.

You can see instructions on how to do this here: [how to change a hosts file on your computer](https://www.hostinger.com/tutorials/how-to-edit-hosts-file).

### Q: I‚Äôm a developer, what do I need to do?

A: Your canisters will be available at <canister-id>.ic0.app as well as <canister-id>.icp0.io. If you do nothing, your users will have the same level of access as they do today. If you start to encounter reports of your app not being available, you can configure your agent to use [icp-api.io](http://icp-api.io/) as an alternative or fallback host.

To ensure that your dApp continues to work properly:

* If you are serving your own service worker, you should make sure you are serving at least [version 1.5.2](https://www.npmjs.com/package/@dfinity/service-worker/v/1.5.2).
* The [Custom Domains](https://internetcomputer.org/docs/current/developer-docs/production/custom-domain/) feature is now widely available and you can use your own domain to serve your dApp.
* We will post more updates and instructions in the coming days.

### Q: What about users not paying attention when this announcement was posted? Are they out of luck? How much time do they have?

A: It would be naive to expect all users to be paying attention to announcements. Still, we hope to reach as many as possible. We also hope to rely on the community to help create awareness.

If more places add ic0.app to a blocklist, sharing or accessing ic0.app links may get increasingly more difficult. However, we expect that for those people immediately affected, using a VPN it will be possible to access ic0.app for a while. But let‚Äôs not count on it and execute the precautionary measures now.

### Q: How can I help?

A: ICP is a protocol and a community so of course all help is always appreciated. The ICP community is known for its helpful culture.There are a few ways you can help:

* Share this post widely
* Remind people to set up their II anchor under identity.internetcomputer.org and to create recovery phrases
* Review NNS proposals coming
* Offer any help or any advice on this thread!

For context, some of the people at DFINITY working closest on this are:

* @jwendling , Team Lead, InfraSec <-- communicating with Spamhaus
* @samuelburri  , VP of Engineering
* @frederikrothenberger , Engineer, Crypto Team
* @maria , Director of Engineering
* @nmattia , Engineer, Crypto Team
* @raymondk , Sr. Engineering Manager, Boundary Nodes

-------------------------

LightningLad91 | 2023-02-17 21:13:40 UTC | #2

Thanks for the heads up. I guess it‚Äôs a good thing everyone pushed for recovery phrases back in the day.

-------------------------

justmythoughts | 2023-02-17 21:22:48 UTC | #3

So say goodbye to the blockchain url? (which was hosted on a centralized domain anyways)

What's going to happen to nns.ic0.app and the sns?

What does this mean for less technical people who have elected to "set and forget" in their NNS dapp.

-------------------------

diegop | 2023-02-17 21:44:39 UTC | #4

Good question. 

Id say the simple version is this: (I did try to make post above simple, seems I fell short of that!)

1. NNS.ic0.app will continue to work 
2. We expect most people to not have any issues
3. If any do have any issues accessing that domain, they have two options:

a. If they had set a recovery, they can go to the new url and use the recovery 

b. If they have not set a recovery, they may need to use a vpn, to create a new recovery 

Does this answer your question in a helpful way?

-------------------------

diegop | 2023-02-17 22:03:36 UTC | #5

I don‚Äôt intend to minimize this or fall into ‚Äúthis is good for Bitcoin‚Äù meme, but I genuinely believe these kinds of things are signs of a blockchain making real contact with the wider internet world. 

It is truly fascinating to watch blockchain and web2/web1 collide into each other, negotiate, iterate, and become part of our daily lives.

-------------------------

Zane | 2023-02-17 22:25:01 UTC | #6

Why do they have to do that? Isn't there support for same principal auth on multiple dApps now?

[quote="diegop, post:1, topic:18537"]
Once you have created a recovery phrase, store it in a safe place. As a reminder, your recovery phrase will allow you to recover your II and NNS wallet (where you may be holding ICP) in case they are in an environment where ic0.app is blocked. ([How to create a recovery phrase? ](https://support.dfinity.org/hc/en-us/articles/13267203903636-How-Do-I-Create-a-Recovery-Phrase-)). If ic0.app is blocked, you would use your recovery phrase to access your anchor on the new domain. ([How to recover account with recovery phrase?](https://support.dfinity.org/hc/en-us/articles/4409372165652-I-cleared-my-browser-cache-and-now-I-m-locked-out-)) Please note: You will not be able to recover your account with a FIDO device, so you must create a recovery phrase if you want to ensure your account is safe.
[/quote]

This looks like an antipattern, the moment your recovery phrase is shown it might already not be in a safe place unless you generated it on a brand new device with a clean OS install, a safe place is supposed to be an airgapped device never connected to the internet, that is what FIDO/security keys are for. On a technical level I don't understand why recovering account with a secret key is possible, but not with an hardware wallet.

-------------------------

mbeekman | 2023-02-17 22:17:14 UTC | #7

This just hit my radar (thanks @lomesh ) ... @peterparker @rckprtr @kpeacock  @icme  ... is this maybe connected to this:
https://forum.dfinity.org/t/nodejs-scripts-timeout/18490
and if so, I would assume the @dfinity sdk would need to be updated with a new URI for the fetch calls it makes ...i.e. https://ic0.app/api/v2/canister/5zc2i-mqaaa-aaaal-abcoa-cai/cal ... they are intermiittantly timing out in the last few days and we have been grasping at "why" ... this might be it and the timing fits ... thoughts?

-------------------------

mparikh | 2023-02-17 22:36:29 UTC | #8

Thanks for the heads up. 

For someone paranoid like me : 

(a) I have a recovery phrase ("locked") that is stored in a distributed fashion, so not easily accessible. 

(b) I was able to add the **first** device without recovery phrase (first option); but NOT without confusion; even with the instructions. I think a quick video explaining this process would help.
 
(c) The act of adding a **second** (and subsequent) devices to the same IIA has an exception flow; which will confuse people. However I can verify that I am able to add a **second** device.

(d) As noted in the instructions, the existing devices registered on ic0 WILL NOT work on internetcomputer.org. You will need to re-add them.

-------------------------

LightningLad91 | 2023-02-17 22:40:36 UTC | #9

Is there any way to add a second recovery phrase  if you don‚Äôt have access to your protected recovery phrase?

Have to say it‚Äôs really unfortunate that recovery devices aren‚Äôt of any help. I thought I was pretty well prepared with a good mix of auth devices. Falling back to a single recovery phrase was not something I had planned for.

-------------------------

mparikh | 2023-02-17 22:42:24 UTC | #10

There is no way to add a second recovery phrase; I think, by design.

-------------------------

yungsucc | 2023-02-17 22:43:34 UTC | #11

More than one hardware recovery key would sure be nice.

-------------------------

LightningLad91 | 2023-02-17 22:43:48 UTC | #12

Copy. I knew we could protect one. I didn‚Äôt realize we couldn‚Äôt add more. Really sucks.

-------------------------

diegop | 2023-02-17 23:28:48 UTC | #13

Hi @Zane 

> Isn‚Äôt there support for same principal auth on multiple dApps now?

Honestly? I wrote multiple draft answers, but as I wrote them, it was clear I did not have clarity of thought. Let me ping the Internet Identity Team or Crypto team to better explain,

> On a technical level I don‚Äôt understand why recovering account with a secret key is possible, but not with an hardware wallet.

I want to make sure I get your question. Are you asking why you cannot use a hardware wallet to recover an II account, but why you have to type it in manually? Is that right?

-------------------------

diegop | 2023-02-17 22:46:27 UTC | #14

[quote="mbeekman, post:7, topic:18537"]
is this maybe connected to this:
[/quote]

I asked SDK team and they are not sure it is connected, but have been looking into this.

-------------------------

diegop | 2023-02-17 22:47:47 UTC | #15

[quote="mparikh, post:8, topic:18537"]
I think a quick video explaining this process would help.
[/quote]

Agreed. I know II team is working on improving the flow as well as the user-facing docs on this. Lots of low hanging fruit the team sees.

-------------------------

diegop | 2023-02-17 22:49:18 UTC | #16

[quote="yungsucc, post:11, topic:18537, full:true"]
More than one hardware recovery key would sure be nice.
[/quote]

Copying some folks from Research and Internet Identity team so they see the feedback:

@frederikrothenberger @nmattia @bjoern @marydwyer @maria

-------------------------

dfisher | 2023-02-17 22:53:46 UTC | #17

Thanks @diegop for the update. IMHO these are great developments. 

We‚Äôre it not for the Casino front end being blocked, work would not be as urgent for boundary node decentralization. We‚Äôre it not for this domain being censored, work would not be as urgent to address this issue. 

The more we block and tackle these issues the more hardened and decentralized the system becomes. I personally think it‚Äôs really great as we are seeing decentralization unfold before our very eyes.

-------------------------

mparikh | 2023-02-17 23:01:13 UTC | #18

After this migration, I can also verify that I am able to access nns at  https://nns.internetcomputer.org/ through both of my devices.

~~The migration **mistakenly** inherits the devices from ic0. After adding the **same** device with a different name, I deleted the device with original name at  intercomputer.org~~

-------------------------

diegop | 2023-02-17 22:57:12 UTC | #19

[quote="mparikh, post:18, topic:18537"]
The migration **mistakenly** inherits the devices from ic0. After adding the **same** device with a different name, I deleted the device with original name at [intercomputer.org](http://intercomputer.org)
[/quote]

Hmm interesting, let me pass this along.

-------------------------

mparikh | 2023-02-17 23:02:55 UTC | #20

Sorry; my bad; 

The migration inherits the devices from ic0. Adding another device also add this device to ic0. So the same device can exist with two separate names; each for different domains (ic0 and internetcomputer)

-------------------------

Dylan | 2023-02-17 23:26:24 UTC | #21

[quote="mparikh, post:20, topic:18537"]
So the same device can exist with two separate names; each for different domains (ic0 and internetcomputer)
[/quote]

I found this kind of confusing. I ended up just naming the *duplicate* device with "(identity.internetcomputer.org)" at the end of the name so that I could tell them apart.

-------------------------

mparikh | 2023-02-17 23:27:51 UTC | #22

The architectural choice between an recovery phrase vs FIDO/Security Key as your primary (and only) recovery mechanism has to do with longevity. The recovery phrase will far out-live any man-made device. Of course the recovery phrase must be guarded (or in my case distributed) so that it is intended to last for generations. 

The implementation decision of this architectural choice is poorly thought through for nns from a security context; although easier from UX context. 

In context of quill, for example, it is possible to have air-gapped machine with the pem file producing a signed message, displaying that through a qr code ; which can instruct through a connected machine.

-------------------------

lastmjs | 2023-02-17 23:32:28 UTC | #23

Thanks for the update. I haven't read all of the comments in this thread.

I thinks it's important to reflect on the design of II. It seems almost unbelievable to me that the design allows a user to possibly lose their II if a domain name disappears.

I think this should be scrutinized and mitigated somehow, quite unnerving. A self-sovereign identity should not be inextricably linked to a centralized naming service.

-------------------------

mparikh | 2023-02-17 23:38:17 UTC | #24

Yes, it is quite unnerving. The first I heard about this  was last year in discussing with @skilesare  et al at a dinner last year.

The saving grace is the fact that the recovery phrase is the self-sovereign identity. Other mechanisms are vassals of the sovereign identity.

-------------------------

Zane | 2023-02-17 23:46:00 UTC | #25

A hardware wallet/security key can still have a seed phrase, difference is it is generated inside an airgapped device with a TPM and it never leaves it whenever you need to actually use the seed. Also I have to worry about safely storing only 1 seed for all cryptos instead of 1 per chain. 

My hw wallet might break but I still have the seed phrase safely stored, so no problems about longevity either.

Up until now I was under the impression that as long as I didnt lose my hw's seed and the II anchors used by the specific dApps I would always have access to my stuff.
I'm clearly missing something but why is the seed needed at all? Why can I recover an ETH wallet using a security key but for II I must use the seed phrase? I could understand if it had to do with principals changing between URLs but now dApps can support multiple domains.
Anyhow it is a serious oversight that one could lose access like this and many community members had warned it could happen months ago. Hopefully it'll get fixed/mitigated in a timely manner.

-------------------------

LightningLad91 | 2023-02-17 23:46:20 UTC | #26

The recovery phrase wasn‚Äôt even part of the original design.

-------------------------

d3w3 | 2023-02-18 00:25:32 UTC | #27

I landed in the same problem area... **Because I skipped the solution mention by @diegop üò©**

>  Setup your Internet Identity anchors to be usable with the newly introduced URL [identity.internetcomputer.org ](http://identity.internetcomputer.org/) 
> **([How to set up your Internet Identity on the new domain ](https://support.dfinity.org/hc/en-us/articles/13270731851156-How-Do-I-Set-Up-My-Internet-Identity-on-the-New-Domain-))** Please note that we are working on UX improvements that will make the process easier.


**Context:**

0. I have an Internet Identity with Seed/Recovery phrase and multiple devices (Brave Browser Profiles & multiple Apple Devices)
1. I navigated to https://identity.internetcomputer.org (Brave Browser)
2. Clicked "Manage Existing" 
3. Selected "Lost Access?"
4. Entered existing anchor in "Enter anchor"
5. Entered existing Seed/Recorvery phrase + clicked "Continue"
6. I get redirected to "Manage your Anchor" on "https://identity.internetcomputer.org/" there I see all my registered devices from "identity.ic0.app"

**Problem with nns.internetcomputer.org**

1. I navigated to https://nns.internetcomputer.org/
2. Selected "Sign in with Internet Identity"
3. Got redirected to "Create an Anchor"
4. Selected "Use existing"
5. Entered the existing anchor
6. Clicked Continue

**üö® üëÜ here I got stuck in browsers select the Passkey modal**

**Workaround to get  nns.internetcomputer.org authentication working (step by step)**

1. Login with existing Internet Identity anchor on https://identity.ic0.app/ with clicking "Manage Existing"
2. Add existing anchor + click "Continue"
3. You then will see "Manage your Account" on https://identity.ic0.app/
4. Click "Add new device"
5. Click "New Browser"
6. **Switch to your "New device/Browser profile"** that should be added *(let the identity.ic0.app on existing device open)*
7. Open identity.internetcomputer.org
8. Select "Manage Existing"
9. Select "Add a new device"
10. Enter your existing Anchor
11. Name the new device (hint suffix with: '(inter...puter.org)')
12. Click "Continue"
13. Perform Browsers add passkey flow
14. Add your presented "Verification Code" to existing device + Click Verify Device
15. Move back to new device and login to https://nns.internetcomputer.org/ with your existing anchor

-------------------------

mparikh | 2023-02-18 00:04:11 UTC | #28

[quote="Zane, post:25, topic:18537"]
why is the seed needed at all
[/quote]

The core issue, I believe , has to do with the manner of implementation on these browser wallets. Since browsers can be hacked, it was thought (and legitimately) that one could remove all of the authentication devices and install only those devices recognized by the hacker. Using a "locked" recovery phrase will give some semblance of security ...in a "secure" setting. Also not every one has a security key(i.e. an ledger). 

@LightningLad91  Indeed it wasn't a part of the original implementation. But fortunately there was a diligent effort by the community to add in this phrase protection. 

As @dfisher points out, this is a blessing in disguise. Because now we are seeing decentralization unfold before our own eyes.

-------------------------

Fulco | 2023-02-18 00:09:18 UTC | #29

Seed phrases weren‚Äôt there at the beginning of the network. Anybody who wanted to back up there identity then had to use an additional device and they might not see this update in time.

I‚Äôm not that knowledgeable about webauthn but do credentials still work when you switch to a custom dns server? 

Then the foundation could potentially setup a custom dns server that resolves ic0.app so that there is always a way to recover your identity.

-------------------------

Zane | 2023-02-18 00:23:45 UTC | #30

[quote="mparikh, post:28, topic:18537"]
Also not every one has a security key(i.e. an ledger).
[/quote]

Not everyone has biometrics either but that hasn't stopped Dfinity from making them mandatory to use II.
I'm strictly talking about hardware wallets, which can be linked to browser wallets like Metamask, but just as a UI, the browser extension still inherits the device security cause the seed phrase never leaves it. But that's beside the point, what I wanted to know was why the recovery option is only available by using the backup method that is by default more vulnerable and prone to attacks. Is it a design choice or are there technical limitations that lead to it and if so what could be done to solve them? Why is the recovery process needed at all? 

Asking users to generate seed phrases on possibly compromised devices instead of incentivizing them to use a hw wallet or straight up not allowing those who have one to use it, is crazy to me. It's a bad practice and completely counter intuitive cause it's the opposite of what users are told in the entire crypto space.

-------------------------

skilesare | 2023-02-18 00:32:03 UTC | #31

I have ledger access via Fido2....@diegop, will these work for access despite the URL?

-------------------------

skilesare | 2023-02-18 00:39:16 UTC | #32

Yes...and I believe the context was the SEC coming for the domain and not Spamhaus...so good that we are getting our ducks in a row now because the SNS is about to get a big fat spotlight on it.  Let's make ourselves anti-fragile to that threat.  How do we make disruption work to our advantage?

@Fulco 's mention of a custom DNS server is super interesting.  Back in the day, I used to hack my local DNS for developing on windows.  Perhaps we need a simple program we can download to run DNS locally when we need to.  I wonder how certs would work with that?  Perhaps the IC is the solution here itself.

-------------------------

paulyoung | 2023-02-18 00:53:33 UTC | #33

Thanks for the info. I have some comments/questions that might inform any upcoming UI/UX improvements.

In general I think it's confusing that my existing devices and recovery methods are there and indistinguishable from the new ones I added through the new domain name.

I now have "duplicate" devices under "Added devices". I would find it helpful if the relevant domain name was shown there if possible.

Multiple places say that recovery keys must be re-added. Since we can only have one, it seems like we're moving the risk from the old domain to the new one. Perhaps one per domain should be allowed.

-------------------------

mparikh | 2023-02-18 00:56:48 UTC | #34

We were very close...to hanahaus. :slight_smile: 

Isn't the issue that google is the top level resolver for .app?

-------------------------

WoW | 2023-02-18 02:47:32 UTC | #35

I have a question. If I have two devices (E.g My PC and phone) that can access to ic0.app. Do I must need to create recovery phase so both of my new devices can access to the new domain? 

I don't really like using recovery phase, it somehow increased the risk of getting my account stolen.

-------------------------

mparikh | 2023-02-18 03:00:04 UTC | #36

You don't **need** to create a recovery phrase so that both of your devices can talk to nns through the new domain. But you **should** create a recovery phase.

In my migration,  i **do** have a recovery phrase. I did not have to touch my recovery phrase to add the two existing devices to the new domain.

That recovery phrase is distributed in three continents...read: it's painful for me to recreate my recovery phrase. But and consequently it is also very difficult for someone to steal my recovery phrase.

-------------------------

diegop | 2023-02-18 03:25:10 UTC | #37

Hey folks,

First of all, thank you all for sharing this post wide and far. 

Second, really appreciate all the comments, suggestions, questions. 

I just want to let you know folks closer to II, boundary nodes, sdk,  etc‚Ä¶ are monitoring this thread (and I‚Äôve pinged a few folks). I‚Äôve deliberately left a few questions or comments unaddressed because I did not feel I had enough expertise to answer with full confidence, clarity of thought, and accuracy.

Thank you all for being a great community!

-------------------------

WoW | 2023-02-18 03:49:46 UTC | #38

Thank you!
Just added my devices to new domain.

-------------------------

lastmjs | 2023-02-18 04:12:19 UTC | #39

I'm increasingly concerned at the nonchalance with which entering seed phrases into internet-connected web UIs is encouraged by the security model of II.

I also am maybe more afraid of this migration than just doing nothing, considering the flurry of activity and complications of the setup/migration I'm seeing others point out (like having multiple devices that are really the same).

-------------------------

cyaolong | 2023-02-18 04:24:04 UTC | #40

After recovered by phrase, I cannot add current device into my anchor. How to solve it?

-------------------------

memetics | 2023-02-18 06:20:34 UTC | #41

If someone is using fido, and needs to add a device to the new domain, can they add the recovery phrase, utilise it to recover account on the new domain, add required devices, then delete the recovery phrase and add Fido as a key again ?

Tldr; how to secure account using only fido or ensure fido remains only access to account

-------------------------

ApeInFoamOhhh | 2023-02-18 06:29:19 UTC | #42

Preemptive damage control I get it, still felt very reluctant doing this seeing as the current method and implementation leaves us vulnerable to security risks...

And this 100%:

[quote="lastmjs, post:23, topic:18537"]
A self-sovereign identity should not be inextricably linked to a centralized naming service.
[/quote]

Hoping this countermeasure is a smooth process as to avoid possible fallout!

-------------------------

Brightcaterpillar | 2023-02-18 06:34:07 UTC | #43

[quote="Zane, post:6, topic:18537"]
Why do they have to do that? Isn‚Äôt there support for same principal auth on multiple dApps now?
[/quote]

Yea why can't we have that? Like taggr, it's having 4 different domain name but we can just still login with the same II.

-------------------------

jwendling | 2023-02-18 09:41:19 UTC | #44

> If someone is using fido, and needs to add a device to the new domain, can they add the recovery phrase, utilise it to recover account on the new domain, add required devices, then delete the recovery phrase and add Fido as a key again ?
>
> Tldr; how to secure account using only fido or ensure fido remains only access to account

Yes, that works!

I recommend using a different name when adding the new device so you can better distinguish the two domains.

-------------------------

mparikh | 2023-02-18 09:42:50 UTC | #45

I use Ledger as Fido. There's no need to touch the Seed Phrase( so far as you can log into ic0.app) to simply add the Fido device to the internetcomputer.org domain. Follow the instructions on top by diego 

Imo: 

(a) you should  have more than one device to login.

(b) you should have a recovery phrase

-------------------------

memetics | 2023-02-18 12:38:35 UTC | #46

From OP:  Please note: You will not be able to recover your account with a FIDO device, so you must create a recovery phrase if you want to ensure your account is safe.

[quote="mparikh, post:45, topic:18537, full:true"]
I use Ledger as Fido. There's no need to touch the Seed Phrase( so far as you can log into ic0.app) to simply add the Fido device to the internetcomputer.org domain. Follow the instructions on top by diego 

Imo: 

(a) you should  have more than one device to login.

(b) you should have a recovery phrase
[/quote]


 
This means we are unable to use Fido to recover our accounts on the new link, unless we set up Fido on the new link utilising the methods above, I think‚Ä¶ I‚Äôm personally waiting for a little more clarity before moving ahead re Fido


I‚Äôd also like to know how many times we are expected to have to do this, is a permanent solution being worked on and is this likely to happen to the new link ( it being blocked too )

-------------------------

Roman | 2023-02-18 13:34:43 UTC | #47

@Zane is definitely making a point. Fully agree. I had not created a recovery phrase, because I wanted to avoid some risk. Dfinity itself [recommended FIDO rather than the recovery phrase](https://support.dfinity.org/hc/en-us/articles/12542648395028-Is-a-recovery-phrase-as-safe-as-a-recovery-FIDO-device-) in an article called : " Is a recovery phrase as safe as a recovery FIDO device ?". Spoiler : the answer is "no" of course.

[quote="Zane, post:25, topic:18537"]
Why can I recover an ETH wallet using a security key but for II I must use the seed phrase?
[/quote]

Clearly, we can't afford such an idiosyncrasy. Particularly since we aim to become a world computer, in which one the II appears as the trusty angular stone to the average user.


So the recovery phrase must be used right now of course, because there is some potential danger, but the best is to eventually find a way to rely exclusively on a seed air gapingly created like Ledger HW make everybody able to do.

A lot of people will create the recovery just to make the transition between the 2 domains, but look forward to deleting it as soon as possible. Let us make them able to do this quickly.

-------------------------

Samer | 2023-02-18 13:48:03 UTC | #48

And if I understand correctly:

Currently it is **not possible** to transfer neuron ownership if we want to opt out of II?

-------------------------

heyuanxun | 2023-02-18 14:23:50 UTC | #50

if a dApp change the domain, will a user's account and principal change? how to change domain safely for a ic dApp dev?

-------------------------

diegop | 2023-02-18 17:25:14 UTC | #52

[quote="jwendling, post:44, topic:18537"]
Yes, that works!

I recommend using a different name when adding the new device so you can better distinguish the two domains
[/quote]

I want to provide some context since this is his first time on the developer forum:

  **@jwendling is the Team Lead of InfraSec at DFINITY, and person working closely on this case (and with spamhaus).** He is one of the experts in this matter.

(I probably should have mentioned that in the original post)

-------------------------

memetics | 2023-02-18 15:14:10 UTC | #53

Dominic Williams should consider suing Spamhaus as they have already tried to sue meta and suing spamhaus would be a global win for defi and perhaps set precedent that we can fight back

-------------------------

radudaniel | 2023-02-18 16:39:58 UTC | #54

Do we know why this happened? I assume they have a process and there is a recourse to prove that this is not spam.

-------------------------

diegop | 2023-02-18 17:02:01 UTC | #55

Hard to be exact and say a definite ‚Äúwhy‚Äù, but Spamhaus communicated the following intent:


*‚Äú Whether or not ic0.app is compromised is not the issue, the issue is that it enables this sort of massively automated malice and hiding the actual destination.‚Äù*

-------------------------

CatPirate | 2023-02-18 17:13:07 UTC | #56

[quote="diegop, post:55, topic:18537"]
the issue is that it enables this sort of massively automated malice and hiding the actual destination
[/quote]


Isn‚Äôt that the whole point of NNS?

-------------------------

mparikh | 2023-02-18 17:22:19 UTC | #57

I am not sure about what exactly **this** is what they consider **automated malice**. Is a **load balancer** also automated malice because it hides the true destination?

I am sure that @jwendling will be able to work this out with spamhaus. 

However if it doesn't get worked out, we will need to think about alternatives because the same logic can be applied to any domain.

-------------------------

jwendling | 2023-02-18 21:51:51 UTC | #58

> However if it doesn‚Äôt get worked out, we will need to think about alternatives because the same logic can be applied to any domain.

Yes, this is a risk that every domain is faced with. But through the Custom Domain feature, canisters can have their own domain, which means we will have more domains in total, and the likelihood of services like NNS being blocked by such blocklists decreases greatly.

-------------------------

mparikh | 2023-02-18 22:09:57 UTC | #59

While i don't have access to the whole context and content response, the quote by Diego 

[quote="diegop, post:55, topic:18537"]
‚Äú Whether or not ic0.app is compromised is not the issue, the issue is that it enables this sort of massively automated malice and hiding the actual destination.‚Äù
[/quote]

leaves me a little jittery. If i read in between the lines (more than i probably should ) , it seems to suggest that the author thinks that something nefarious is going on behind the scenes (i.e. use word **malice** and phrase **hiding the actual destination**). Without **malice**, when we host even a backend with update, who is serving the response,  is **"hidden"** by design; in the sense that we have many replicas getting the update call.

This is why, imo, we should close this asap with Spamhaus; because it will,  otherwise, trigger a cascading impact on dns servers. The fact that nns is now on internetcomputer.org is of no consolation ; because logically, they will block that as well.

**Of course not having all the context may mean that i am being too paranoid**. But, as i have mentioned before,only the paranoid survive in this game. More than happy to be proven wrong in the previous two paragraphs.

-------------------------

Denis | 2023-02-19 03:31:26 UTC | #60

Do you think one possible solution is to have a domain reserved for core services and apps? Perhaps an NNS vote could be required to have a site on that core services domain, making it a community whitelisted IC. That way, we avoid having to censor while also sealing off any nonsense that goes on in the wider network from systemically important services. Because making a malicious website or app is extremely easy. Now that this issue is public, people will do it just to sabotage the IC.

-------------------------

memetics | 2023-02-19 20:07:20 UTC | #62

Why does Fido not work at all if set up accounts on both links you can only have access to one link using Fido recovery max
Patch needed
I have set up devices on both links, and Fido now only works on the new link

-------------------------

diegop | 2023-02-19 20:53:23 UTC | #63

# Important Update:

### Spamhaus as removed `ic0.app` from its blocklist.

Thank you @jwendling and others who worked to communicate with Spamhaus.

Please note that:

1. All the short term, medium term, long term actions listed are still being implemented
2. It is still good practice to have a recovery phrase

I *expect* this this thread to remain open and active so we can all discuss, ask questions, give feedback, etc...

Thank you everyone for engaging in this and sharing it wide among the ICP ecosystem.

-------------------------

Roman | 2023-02-19 21:31:54 UTC | #64

On my side, FIDO (same device) works on the old and the new link. I even removed the recovery phrase.

-------------------------

rckprtr | 2023-02-20 00:36:23 UTC | #65

Would be cool to see what steps you guys took to appeal it.  This has happened to DSCVR a couple times and we just filled out all the AV/ISP appeal forms and it went away.  

Its been awhile since I've last noticed it so maybe once they get you in the registry they stop happening. Lots of websites use sub-domains for their apps so I imagine they are a bit understanding.

-------------------------

Mr_Burkes | 2023-02-20 03:42:51 UTC | #66

Why is II domain-dependent? Can't the IC sign messages that prove authenticity? Can't this signature be done for authorization credentials?

-------------------------

diegop | 2023-02-20 18:17:29 UTC | #67

Please note that I have updated the main forum post (based on input from Crypto team):

[quote="diegop, post:1, topic:18537"]
UPDATE: Now that ic0.app has been removed from the block list, we recommend that users wait to migrate their devices until we complete work on the migration path. In case of an emergency, make sure that you have a usable recovery phrase following the instructions listed above.
[/quote]

-------------------------

bjoern | 2023-02-21 10:01:00 UTC | #68

[quote="lastmjs, post:23, topic:18537"]
I thinks it‚Äôs important to reflect on the design of II. It seems almost unbelievable to me that the design allows a user to possibly lose their II if a domain name disappears.
[/quote]

The [web authentication standard](https://www.w3.org/TR/webauthn/) specifies that the credentials are bound to the _origin_, meaning (amongst others) the _domain name_. So as long as we are in the realm of web authentication (which allows us to combine a pretty good level of security with a pretty good level of usability), there is not much we can fundamentally do about this. That doesn't mean that things did not go wrong or we shouldn't change things, it just limits our options.

[quote]
I think this should be scrutinized and mitigated somehow, quite unnerving. A self-sovereign identity should not be inextricably linked to a centralized naming service.
[/quote]

Let's have a closer look at the details.

- **The use of `ic0.app`**: The decision to serve Internet Identity under `identity.ic0.app` was, in retrospect, wrong. I don't think there's much more to say about this now, other than that we already had planned migrating to `identity.internetcomputer.org` before this incident; the incident simply began before we had the nice UI flow prepared. This work will continue, and we will migrate to the new domain regardless. As the content under `internetcomputer.org` is controlled much stricter than under `ic0.app`, the domain is much less likely to suffer from such an incident.
- **Different ways of blocking `ic0.app`**: There are different possible levels of impact for the domain name, and the one we saw is actually the most benign. It is relatively easy to circumvent on the client side with a moderate level of tech savviness (use a different DNS resolver like `8.8.8.8` or `1.1.1.1`, use a VPN). A worse level would be Google (the owner of `.app`) completely blocking the domain. In that case, users would have to change domain resolution (e.g. edit `/etc/hosts`, or set the DNS resolver to one that DFINITY or the community could provide, which would still resolve `ic0.app`) and accept a certificate that is not issued by a generally trusted CA, as Let's Encrypt, now any other CA, would not extend our certificates for `ic0.app` any longer. It seems unlikely that the latter would apply to `internetcomputer.org`.
- **Recovery phrases**: As you pointed out in a different message, recovery phrases as implemented in Internet Identity today have serious security drawbacks. In contrast to the web authentication keys, they are not held on a specific secure chip but simply in browser memory, which makes them more prone to attacks.

So where does that leave us and where should we go? In principle I see three avenues:
1. Make the use of web authentication more reliable: This is the path we are already taking with `identity.internetcomputer.org`. Additional steps could be extending the IC to act as a DNS resolver or providing web extensions for browsers.
2. Provide additional recovery options ‚Äì recovery phrases have security drawbacks and recovery devices still suffer from the domain name problem. Tech-savvy users can already use `dfx` or `ic-repl` to effectively register an additional "device," possibly even with a key stored on an air-gapped device. We could have a phone app that works in exactly the same way as the recovery phrase, but without the use of browsers?
3. Remind everyone to use hardware wallets for managing (at least larger amounts of) tokens and neurons. Internet Identity is great for authenticating toward dapps, but it still fundamentally relies on the security of the browser (which is the still piece of software most likely to be affected by zero days), and so fundamentally that isn't a good way of managing things of significant value.

-------------------------

bjoern | 2023-02-21 10:05:51 UTC | #69

[quote="Fulco, post:29, topic:18537"]
I‚Äôm not that knowledgeable about webauthn but do credentials still work when you switch to a custom dns server?

Then the foundation could potentially setup a custom dns server that resolves ic0.app so that there is always a way to recover your identity.
[/quote]

Yes, the credentials would still work with a custom DNS resolver, and this would be one possibility for recovery. It works well on Desktop, but to the best of my knowledge isn't really an option for mobiles on a cellular network.

-------------------------

bjoern | 2023-02-21 10:07:32 UTC | #70

The domain dependency of II comes from web authentication ‚Äì the mechanism in the browser that allows us to access keys stored in the secure chips of the devices. That policy is enforced by the browser, there's nothing that II can do to circumvent it.

-------------------------

lastmjs | 2023-02-21 13:37:58 UTC | #71

[quote="bjoern, post:68, topic:18537"]
Remind everyone to use hardware wallets for managing (at least larger amounts of) tokens and neurons. Internet Identity is great for authenticating toward dapps, but it still fundamentally relies on the security of the browser (which is the still piece of software most likely to be affected by zero days), and so fundamentally that isn‚Äôt a good way of managing things of significant value.
[/quote]

I wish I had known/understood this back in 2021. I feel like the marketing/eduction around II vs hardware wallets wasn't really present, or at least I missed it. Seems to me that most of the lay people in the community believe (believed?) II to be extremely secure. It's only after digging in that we discover these flaws.

So a concrete suggestion is to fix the education/marketing of II, or increase its security. How many people have locked up a lot of ICP on the NNS using II? Probably a lot of people. And the unfortunate thing is that there is currently no way to change that choice AFAIK.

-------------------------

lastmjs | 2023-02-21 13:40:19 UTC | #72

[quote="bjoern, post:68, topic:18537"]
**Different ways of blocking `ic0.app`**: There are different possible levels of impact for the domain name, and the one we saw is actually the most benign. It is relatively easy to circumvent on the client side with a moderate level of tech savviness (use a different DNS resolver like `8.8.8.8` or `1.1.1.1`, use a VPN). A worse level would be Google (the owner of `.app`) completely blocking the domain. In that case, users would have to change domain resolution (e.g. edit `/etc/hosts`, or set the DNS resolver to one that DFINITY or the community could provide, which would still resolve `ic0.app`) and accept a certificate that is not issued by a generally trusted CA, as Let‚Äôs Encrypt, now any other CA, would not extend our certificates for `ic0.app` any longer. It seems unlikely that the latter would apply to `internetcomputer.org`.
[/quote]

Seems in the worst case a solution could still be provided to recover the identities by setting up custom DNS/certificates. That's at least better than having no recourse whatsoever.

-------------------------

Denis | 2023-02-21 13:45:32 UTC | #73

[quote="bjoern, post:68, topic:18537"]
As you pointed out in a different message, recovery phrases as implemented in Internet Identity today have serious security drawbacks. In contrast to the web authentication keys, they are not held on a specific secure chip but simply in browser memory, which makes them more prone to attacks.
[/quote]

Does this mean all recovery phrases are vulnerable to being hacked, and everybody staking on Internet Identity could lose their coins if a hack successfully harvests recovery phrases?

-------------------------

diegop | 2023-02-21 16:17:40 UTC | #74

[quote="Denis, post:73, topic:18537"]
Does this mean all recovery phrases are vulnerable to being hacked
[/quote]

I believe he means that since the recovery phrase is *shown on the browser* when you generate it, this automatically makes the browser aware of the recovery phrase during that time, which in in theory makes it a danger, even if the recovery phrase is there for only a few minutes or seconds. *Please note this is the case for ALL web-based products that show the users a seed phrase (either the extension or browser could in theory be compromised).* 

I would assume that if such a browser hack existed, it would have been exploited much earlier in other wallets or extensions, but this does not rule out that it may yet present itself.

Meanwhile, the FIDO/WebAuthn authentication never show the private keys to the browser so the browser is unaware.

-------------------------

JaMarco | 2023-02-22 01:07:15 UTC | #75

[quote="lastmjs, post:71, topic:18537"]
So a concrete suggestion is to fix the education/marketing of II, or increase its security. How many people have locked up a lot of ICP on the NNS using II? Probably a lot of people. And the unfortunate thing is that there is currently no way to change that choice AFAIK.
[/quote]
So you can't switch to using a hardware wallet after first using II?

-------------------------

blabagastered | 2023-02-22 04:42:22 UTC | #76

[quote="bjoern, post:68, topic:18537"]
Internet Identity is great for authenticating toward dapps, but it still fundamentally relies on the security of the browser (which is the still piece of software most likely to be affected by zero days), and so fundamentally that isn‚Äôt a good way of managing things of significant value.
[/quote]

Is there a secure way to authenticate into dapps (that's "a good way of managing things of significant value")?

-------------------------

bjoern | 2023-02-22 08:44:37 UTC | #77

[quote="lastmjs, post:71, topic:18537"]
I wish I had known/understood this back in 2021. I feel like the marketing/eduction around II vs hardware wallets wasn‚Äôt really present, or at least I missed it. Seems to me that most of the lay people in the community believe (believed?) II to be extremely secure. It‚Äôs only after digging in that we discover these flaws.
[/quote]

Let me clarify. Authentication with II is still _fundamentally_ more secure than browser-based wallets like Metamask or Plug, because the cryptographic key resides in a secure hardware chip and outside of the realm of the browser or even the computer's main memory. It is, however, also _fundamentally_ less secure than a hardware wallet, since the hardware wallet will allow you to inspect the transaction. With web authentication, you as a user must be involved (e.g. fingerprint or face scan), but you don't see the transaction details.

Let me put out some numbers. Here are values that I would feel comfortable with managing in different ways (these are based on my personal risk profile, everyone will have different limits):
- Browser wallet (e.g. Metamask/Plug) on my own general-purpose devices: $100s, for short time maybe $1'000s.
- Internet Identity on my own general-purpose devices: $1'000s, for short time maybe $10'000s.
- Browser wallet or Internet Identity on a "clean" device that I only use for one specific application _that I personally trust, and where the front-end is decentralized_ (e.g. nns.internetcomputer.org) and that I never connect to public networks: $10'000s and maybe a bit more if I am paranoid about keeping the device clean.
- Hardware wallet (which I _never_ connect to a device I don't own): $100'000s.
- Custom cold-storage/air-gap setup: Anything beyond.

So I did not want to suggest that Internet Identity wasn't secure ‚Äì quite to the contrary! I personally think it has the best trade-off between security and usability for day-to-day use. I just want to encourage the use of "non-day-to-day" methods for cases for large amounts of tokens.

-------------------------

bjoern | 2023-02-22 08:48:52 UTC | #78

[quote="Denis, post:73, topic:18537"]
Does this mean all recovery phrases are vulnerable to being hacked, and everybody staking on Internet Identity could lose their coins if a hack successfully harvests recovery phrases?
[/quote]

Yes, in exactly the same way as that hack would reveal the private key in your Metamask/Plug/... browser wallet. There is an important difference, though: The recovery phrase is created once and then deleted from your computer's memory, you probably don't use it until you lose access to your identity anchor. The browser wallet will have the cryptographic key in memory every time you make transactions. So in reality, the attack surface for the Internet Identity recovery phrase is still a lot smaller than the one for typical browser-based wallets.

-------------------------

bjoern | 2023-02-22 08:50:56 UTC | #79

[quote="JaMarco, post:75, topic:18537"]
So you can‚Äôt switch to using a hardware wallet after first using II?
[/quote]

The NNS disallows the change of the controller for an existing neuron. This is not specific to II, it generally means you cannot change the means of controlling your neurons.

-------------------------

bjoern | 2023-02-22 08:58:46 UTC | #80

[quote="blabagastered, post:76, topic:18537"]
Is there a secure way to authenticate into dapps (that‚Äôs ‚Äúa good way of managing things of significant value‚Äù)?
[/quote]

No, at least there is not a general solution. I think there is a fundamental contradiction between the two: I want to be able to use my day-to-day dapps in my browser, without explicitly authorizing every transaction from a separate, secure device. For managing things of significant value, I would not trust the browser, and I would want to authorize every transaction from a separate, secure device. I think applications like DeFi should have support for things such as a hardware wallet.

-------------------------

blabagastered | 2023-02-22 09:50:28 UTC | #81

To be sure I understand correctly: 

(a) If you create an Internet Identity anchor, then add a Ledger Nano device via FIDO, then delete your biometric device so that the only remaining device is the Ledger Nano, and you don't ever create an II recovery phrase (since it is displayed and generated by your insecure, internet-connected device), is that secure / comparably secure to eg using a Ledger Nano via Metamask on Ethereum, or is it still insecure due to it still using using Internet Identity as the base layer?

(b) If you instead do Ledger Nano via Metamask via NFID (it still uses II in the background I think) to authenticate into a dapp, and again do not "trust" any device and only use it with the Ledger Nano, is that still insecure for significant value?



[quote="bjoern, post:80, topic:18537"]
applications like DeFi should have support for things such as a hardware wallet
[/quote]

(c) if (a) and (b), which use II, are not secure, how does a dev add support for a hardware wallet into their dapp?

-------------------------

bjoern | 2023-02-22 11:23:00 UTC | #82

[quote="blabagastered, post:81, topic:18537"]
(a) If you create an Internet Identity anchor, then add a Ledger Nano device via FIDO, then delete your biometric device so that the only remaining device is the Ledger Nano, and you don‚Äôt ever create an II recovery phrase (since it is displayed and generated by your insecure, internet-connected device), is that secure / comparably secure to eg using a Ledger Nano via Metamask on Ethereum, or is it still insecure due to it still using using Internet Identity as the base layer?
[/quote]

The FIDO app on the Ledger Nano is a great recovery mechanism for Internet Identity, but mostly because you can have a backup of the keys (which you cannot have with most other FIDO devices like a Yubikey). The security properties are not fundamentally different from other web authentication devices that support user verification, because you cannot actually validate the contents of transactions.

[quote]
(c) if (a) and (b), which use II, are not secure, how does a dev add support for a hardware wallet into their dapp?
[/quote]

The ICP app on the Ledger Nano that you can install today supports only a fixed set of transactions for the governance and ICP ledger canisters. The next version, which is in review with Ledger literally at this very moment, adds more generic support for some SNS and ICRC-1 transactions (as per [this PR](https://github.com/Zondax/ledger-icp/pull/195)).

We are currently designing a scheme that allows _any_ canister on the Internet Computer to use the ICP hardware wallet app for securely displaying and signing transactions, and that would work as follows:
- The canister developer specifies for each pair of (canister id, method name) a schema for rendering the parameters. That would likely be a transaction name and a structure that specifies for each field of the Candid argument whether it should be displayed and the title that should be used. (We need to devise a format for this, this actually is the main open design task.)
- The canister then signs said schema with the IC's threshold ECDSA signature method.
- The dapp front end sends the unsigned transaction along with the signed schema to the hardware wallet.
- The hardware wallet derives the canister's ECDSA public key from the IC's ECDSA root public key and the canister id, and verifies the signature on the schema. It then uses the schema to display the transaction to the user, and signs the transaction when the user approves.

How does that sound?

-------------------------

blabagastered | 2023-02-22 12:20:26 UTC | #83

[quote="bjoern, post:82, topic:18537"]
How does that sound?
[/quote]

I hear two sounds. One general, one particular.

The particular one, without attempting a detailed evaluation of the proposed solution, is that I worry about the timing (ie when might this be available for use in production, especially considering adopting this approach to security may require re-modelling an application's flow, data structure, architecture, and extra work aside, it can really only begin once this is totally finished), and also worry about the reliance on threshold signing as currently implemented (see for example from 48:00 here https://twitter.com/i/spaces/1gqxvyREnwlJB?s=20 together with (https://discord.com/channels/748416164832608337/748416164832608341/1074992870781616159) ), which sort of steps on the general:

The general is that, without knowing the foundation's work from within or the core protocol in any detail, my impression is that the number, breadth and depth of security vulnerabilities in the system, understood as broadly as possible, ie in the only way in which it makes sense to understand it in production, in "the real world", appears to be large enough that perhaps all work should be suspended, on every sphere of the foundation's technical efforts, until all major security concerns have been addressed and fixed to a point such that a dapp deployed on the IC, with its then existing implementation (not a future imagined one) is comparably secure to what is achieved by competing systems today.

It may sound radical or alarmist, and I would be glad if it were so, but I can't help but conclude that without security, there can be no public blockchain, or certainly no responsible use of it at anything remotely like the scale of the IC vision.

I say this in the most constructive tone possible: yes, I am alarmed, but if the will (and perhaps courage) to really look at security is there, and to tackle it _whatever the cost_, and I'd expect it to be a very uncomfortable exercise, I have a feeling the foundation, with its great technical resources, is still not beyond a point of no return where such fixing becomes effectively incompatible with the IC gaining traction within a time window such that its long term survival and thriving is achieved.

-------------------------

Denis | 2023-02-22 16:00:19 UTC | #84

[quote="bjoern, post:78, topic:18537"]
The browser wallet will have the cryptographic key in memory every time you make transactions.
[/quote]

Okay, thanks for clarifying. I was aware of the risks at the user end, your post just got me worried there were risks at the NNS website / Internet Identity end that I was unaware of that were similar to the risks involved with browser wallets like Metamask.

-------------------------

Roman | 2023-02-22 19:29:42 UTC | #85

Hi @bjoern,

Thank you for your answer. 
[quote="bjoern, post:82, topic:18537"]
We are currently designing a scheme that allows *any* canister on the Internet Computer to use the ICP hardware wallet app for securely displaying and signing transactions, and that would work as follows:

* The canister developer specifies for each pair of (canister id, method name) a schema for rendering the parameters. That would likely be a transaction name and a structure that specifies for each field of the Candid argument whether it should be displayed and the title that should be used. (We need to devise a format for this, this actually is the main open design task.)
* The canister then signs said schema with the IC‚Äôs threshold ECDSA signature method.
* The dapp front end sends the unsigned transaction along with the signed schema to the hardware wallet.
* The hardware wallet derives the canister‚Äôs ECDSA public key from the IC‚Äôs ECDSA root public key and the canister id, and verifies the signature on the schema. It then uses the schema to display the transaction to the user, and signs the transaction when the user approves.
[/quote]

Does this mean that we can hope hold our NFT through the Ledger Hardwallet soon ? If yes, it is marvelous, and what would the timeline be (approximatively of course) ?

-------------------------

skilesare | 2023-02-22 19:46:13 UTC | #86

[quote="lastmjs, post:71, topic:18537"]
I wish I had known/understood this back in 2021. I feel like the marketing/eduction around II vs hardware wallets wasn‚Äôt really present, or at least I missed it. Seems to me that most of the lay people in the community believe (believed?) II to be extremely secure. It‚Äôs only after digging in that we discover these flaws.
[/quote]

I also don't understand why we still don't have the signing of cbor messages with ledger available.  we should be able to interact with certain sites with our ledger.

-------------------------

hokosugi | 2023-02-22 21:56:34 UTC | #87

Among the authentication types of Internet Identity, Security key is the most secure because it never passes through the browser or memory, and biometric authentication is equally secure because it is stored in the hardware chip (TPM) in the PC. However, the seed phrase is less secure because it is temporarily stored in memory when it is generated and then deleted.

Security key >= biometric >> seed phrase

Seed phrase with low security is problematic, so security key is recommended, is that correct?

Even so, it is more secure than browser-based wallets like Metamask and Plug. Because,

* Seed phrase is a one-time use of memory (and then deleted), while browser-based wallets are stored in memory for each signature to tx.

* Browser-based wallets do not store the private key in the TPM like biometric authentication, but rather store it encrypted in the local storage of the browser, which is less secure ( I could be wrong).

However, the most secure one is a hardware wallet like Security key, which does not pass the private key through browser or memory, and verifies and displays the tx on the hardware, so we are considering to develop it so that we can use it. Is that correct?

hardware wallet(ongoing) > Security key >= biometric > seed phrase >> browser-based wallets

-------------------------

lastmjs | 2023-02-22 22:03:20 UTC | #88

Depends on the application for II because of the ephemeral private key stored in local storage. This is even worse than MetaMask. That key can do anything that the II can do, so your WebAuthN device isn't providing any security after you've logged in.

What would be amazing is if we could require additional verification from a WebAuthN device for certain actions.

-------------------------

bjoern | 2023-02-22 22:36:40 UTC | #89

II never stores key material in local storage. That's why you have to re-authenticate on every login.

-------------------------

bjoern | 2023-02-23 12:47:27 UTC | #90

[quote="blabagastered, post:83, topic:18537"]
The particular one, without attempting a detailed evaluation of the proposed solution, is that I worry about the timing (ie when might this be available for use in production, especially considering adopting this approach to security may require re-modelling an application‚Äôs flow, data structure, architecture, and extra work aside, it can really only begin once this is totally finished), and also worry about the reliance on threshold signing as currently implemented (see for example from 48:00 here [https://twitter.com/i/spaces/1gqxvyREnwlJB?s=20 ](https://twitter.com/i/spaces/1gqxvyREnwlJB?s=20) together with ([Discord ](https://discord.com/channels/748416164832608337/748416164832608341/1074992870781616159)) ), which sort of steps on the general:
[/quote]

It's probably realistic to build this functionality in the Ledger application in a few months. The additional implementation effort is moderate, but such an update will have to go through a security review with Ledger, which will usually take a while.

Regarding the concerns with threshold ECDSA signing: We are following three different paths toward improving the security over time:
1. Diversifying the set of node providers (NPs). If you have been following NNS proposals recently, you must have seen several proposals registering new NPs. So the IC is getting more diversity in its nodes, which will allow the NNS to improve the diversity of nodes in the subnets that host the threshold keys, and also grow that subnet over time. As with anything organic, that just needs a bit of time to grow.
2. Supporting trusted execution environments (TEEs). We are building support for AMD's SEV-SNP in the node deployments, which provide some additional security against potentially malicious NPs. This work is in progress, and will play well with the new "Gen 2" node architecture that the new NPs are rolling out.
3. Threshold trade-off: We can parameterize the protocol to achieve better security (meaning: improved resilience in terms of number of NPs that have to collude to create a signature) at the cost of weaker liveness (less misbehaving NPs could stop the subnet from issuing signatures). This is a protocol-level improvement that is orthogonal to the above two.

[quote]
The general is that, without knowing the foundation‚Äôs work from within or the core protocol in any detail, my impression is that the number, breadth and depth of security vulnerabilities in the system, understood as broadly as possible, ie in the only way in which it makes sense to understand it in production, in ‚Äúthe real world‚Äù, appears to be large enough that perhaps all work should be suspended, on every sphere of the foundation‚Äôs technical efforts, until all major security concerns have been addressed and fixed to a point such that a dapp deployed on the IC, with its then existing implementation (not a future imagined one) is comparably secure to what is achieved by competing systems today.
[/quote]

I don't think that this is fair, on multiple levels. First, there is (and has always been) ongoing work toward improving the security of ICP, in several components and aspects. We have made significant improvements since launch, and we will continue doing so. This work often receives less publicity, of course, since in many cases it is just invisible to users.

Second, you seem to imply that deploying on the IC was generally less secure than on "competing systems." The statement is vague and thus hard to respond to, but I would guess that such comparisons are generally hard because they tend to compare apples with oranges. Anyway, I'd be interested to know what you had in mind.

Third, it would be infeasible (and not helpful either) to now stop all the work we are doing and focus on a single aspect, like security. Are there security aspects we have to work on? Absolutely! But so are aspects of scalability (e.g., number of neurons in the governance canister, number of canisters on a subnet, size of the state a subnet can handle), developer experience, and so forth.

-------------------------

lastmjs | 2023-02-23 13:11:19 UTC | #91

The ephemeral keys must be stored somewhere accessible to the domain (accessible to its JS) so that signing can occur, I don't understand this.

My understanding is there is a keypair created on every login that can sign for the II. That key is not protected by hardware and is accessible to JS and thus XSS or other similar attacks.

-------------------------

blabagastered | 2023-02-23 15:04:54 UTC | #92

[quote="bjoern, post:90, topic:18537"]
Anyway, I‚Äôd be interested to know what you had in mind.
[/quote]

I've got a page or two of notes on security concerns I've come across while building the prototype of Backed USD, but managed to make myself busy again and don't have time to flesh it out now. I hope to within a week or so. 

For now, I'll just dispel a couple of possible misunderstanding, plus stating that the fact that there is no way to securely connect to a dapp is alone probably enough to concede that the system is not "as secure as competing systems" today.

First, as a relative newcomer I have no idea why the foundation has chosen to do the things it's done: all I know is you've managed to create a groundbreaking system that mostly works. What I mean is only that, as you know, the world doesn't care about how efficiently we allocate resources or how diligently we work: it only cares about the outcome, the concrete offering. What I mean is I don't claim there haven't been security improvements, perhaps massive ones that have required great effort and dexterity. I only claim that if those don't amount to equal or better than the alternative, we're in trouble. In particular, I mean no criticism of the foundation or its work (I don't understand it well enough internally to comment): I only mean that _the situation_ we're in, the state of the network, is vulnerable to several attacks for a host of reasons, regardless of how much or how little work or improvements or what reasons have led to it.

1, 2, 3 above are important improvements (I understand 3 less well). They help.

Regarding 

[quote="bjoern, post:90, topic:18537"]
it would be infeasible (and not helpful either) to now stop all the work we are doing and focus on a single aspect, like security
[/quote]

Maybe, I don't know, that's why I say "perhaps", and "appears to be". But also, maybe not, and perhaps the situation is such that really an exclusive focus on security would make sense for a while. It is not at all obvious to me from what I've seen.

If all goes well I hope to be back with a more detailed response soon.

-------------------------

bjoern | 2023-02-24 08:11:55 UTC | #93

[quote="blabagastered, post:92, topic:18537"]
I‚Äôve got a page or two of notes on security concerns I‚Äôve come across while building the prototype of Backed USD, but managed to make myself busy again and don‚Äôt have time to flesh it out now. I hope to within a week or so.
[/quote]

That would be very helpful ‚Äì looking forward to that!

-------------------------

bjoern | 2023-02-24 08:29:35 UTC | #94

[quote="lastmjs, post:91, topic:18537"]
The ephemeral keys must be stored somewhere accessible to the domain (accessible to its JS) so that signing can occur, I don‚Äôt understand this.
[/quote]

There is an ephemeral key that is kept in memory, which is [created for each session](https://github.com/dfinity/internet-identity/blob/main/src/frontend/src/utils/iiConnection.ts#L435). I just checked that we are currently using a key that is actually accessible to JS, it seems preferable to use a type of key where at least the private key [cannot be extracted](https://github.com/dfinity/agent-js/blob/main/packages/identity/src/identity/ecdsa.ts#L56) from JS. I'll check with the team when they plan to migrate there. Either way, this is entirely in the origin of II, and we intentionally keep the codebase of II small and simple.

-------------------------

dfisher | 2023-02-24 16:46:42 UTC | #95

Why is using an air gapped device more secure than a hardware wallet?

-------------------------

diegop | 2023-02-24 17:19:02 UTC | #96

Not an expert like Bjoern is but i *interpreted* his statement that air gapped removes the potential of a bug in the hardware wallet. 

Air gap has no internet connection so no potential for bugs (hardware wallets have very limited basic software, but still software) or hardware design flaws to affect you.

-------------------------

apotheosis | 2023-02-28 01:49:03 UTC | #97

Hey - we switched all of our domains to icp0.io last week because of this warning... we come back after the weekend to find users complaining that domain throws errors on their browsers and the original domain ic0.app does not... what is going on here? 

Which one should be used as of 2-28-2023?

-------------------------

apotheosis | 2023-02-28 02:00:07 UTC | #98

For icp0.io domain..

![Screen Shot 2023-02-28 at 10.59.49|690x395](upload://frHip0b0npv9S2QjkDhXhhuR0g0.jpeg)

-------------------------

jwendling | 2023-02-28 12:17:00 UTC | #99

Hey apotheosis!

Unfortunately, we discovered that the domain `icp0.io`, which we recently introduced as an alternative default domain, has been used for malicious content.

As a result the following providers/products have flagged `raw.icp0.io` (only the subdomain raw) on their list as spam/phishing:
* Google Safebrowsing
* Netcraft
* Kaspersky
* Emisoft

We will work with the providers/products and were already able to remove the entry of Netcraft, Kaspersky and Emisoft.

Update: Sorry mixed the domains in my original post. It's now updated to raw.icp0.io.

-------------------------

apotheosis | 2023-02-28 12:16:00 UTC | #100

Thanksüôè  switching back to the old one.

-------------------------

jwendling | 2023-02-28 12:36:47 UTC | #101

Depending on how much effort it is for you to switch and how much you rely on `raw` URL, I would suggest to not switch back yet, because the same risk also applies to ic0.app, as we experienced with the Spamhaus listing.
In general its highly recommended to use custom domains to not rely on either of them.

Update: Just double checked your canister id from the screenshot and Kinic is indeed a special use case. So in your case switching definitely makes sense.

-------------------------

Denis | 2023-02-28 14:17:19 UTC | #102

[quote="jwendling, post:99, topic:18537"]
Unfortunately, we discovered that the domain `icp0.io`, which we recently introduced as an alternative default domain, has been used for malicious content.
[/quote]

This will keep happening with every domain. It's a trivially simple attack vector that is now widely known. I reiterate what I suggested upthread: 
"Have a domain reserved for core services and apps. Perhaps an NNS vote could be required to have a site on that core services domain, making it a community whitelisted IC. That way, we avoid having to censor while also sealing off any nonsense that goes on in the wider network from systemically important services. Because making a malicious website or app is extremely easy. Now that this issue is public, people will do it just to sabotage the IC."

-------------------------

jwendling | 2023-02-28 18:58:09 UTC | #103

**Good news:** raw.icp0.io is not listed on **Google Safe Browsing** anymore and the red warning should disappear.

-------------------------

